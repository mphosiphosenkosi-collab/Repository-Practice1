# .github/workflows/main.yaml
name:  CI - Basic Validation

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  validate:
    name: Validate Project Structure
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Validate README exists
        run: |
          echo "üîç Checking for required documentation..."
          if [ -f "README.md" ]; then
            echo "‚úÖ README.md found"
            echo "File size: $(wc -l < README.md) lines"
          else
            echo "‚ùå README.md not found - creating placeholder"
            echo "# Project Documentation" > README.md
          fi

      - name: Check directory structure
        run: |
          echo "üìÅ Project structure check:"
          echo "========================"
          
          # Create expected directories if they don't exist
          mkdir -p src/backend src/frontend tests docs docker
          
          # List what we have
          ls -la
          echo "---"
          echo "src/ contents:"
          ls -la src/ || echo "src/ directory created"
          
          echo "‚úÖ Basic structure validated"

      - name: Markdown validation
        run: |
          echo "üìù Checking documentation format..."
          
          # Simple markdown check (no external tools)
          if [ -f "README.md" ]; then
            echo "--- README.md preview (first 10 lines) ---"
            head -10 README.md
            echo "-----------------------------------------"
          fi
          
          # Check for required sections (simple grep)
          REQUIRED_SECTIONS=("Quick Start" "Prerequisites" "Environment")
          for section in "${REQUIRED_SECTIONS[@]}"; do
            if grep -i "$section" README.md > /dev/null; then
              echo "‚úÖ README contains '$section' section"
            else
              echo "‚ö†Ô∏è  README missing '$section' section"
            fi
          done

      - name: YAML syntax check
        run: |
          echo "‚öôÔ∏è  Checking workflow files..."
          # Check this workflow file syntax
          if python3 -c "import yaml; yaml.safe_load(open('.github/workflows/main.yaml'))"; then
            echo "‚úÖ Workflow YAML syntax is valid"
          else
            echo "‚ùå Workflow YAML syntax error"
            exit 1
          fi

      - name: Create success artifact
        if: success()
        run: |
          echo "üéâ All validations passed!"
          date > validation-success.txt
          echo "Project: Conference Room Booking System" >> validation-success.txt
          echo "Validated: $(date)" >> validation-success.txt
          echo "Branch: ${{ github.ref }}" >> validation-success.txt
          
          # Create a simple report
          cat > validation-report.md << EOF
          # Validation Report
          
          ## Summary
          - ‚úÖ README documentation: Present
          - ‚úÖ Directory structure: Valid
          - ‚úÖ Workflow syntax: Correct
          - ‚úÖ Basic formatting: Acceptable
          
          ## Next Steps
          1. Begin backend implementation in \`src/backend/\`
          2. Begin frontend implementation in \`src/frontend/\`
          3. Add tests to \`tests/\` directory
          
          Validated at: $(date)
          EOF

      - name: Upload validation report
        uses: actions/upload-artifact@v4
        with:
          name: validation-report
          path: |
            validation-success.txt
            validation-report.md
          retention-days: 5

  documentation-check:
    name: Documentation Quality
    runs-on: ubuntu-latest
    needs: validate
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Essential files check
        run: |
          echo "üìã Checking for essential project files..."
          
          ESSENTIAL_FILES=(
            "README.md"
            ".gitignore"
            "docker-compose.yml"
            ".env.example"
          )
          
          score=0
          total=${#ESSENTIAL_FILES[@]}
          
          for file in "${ESSENTIAL_FILES[@]}"; do
            if [ -f "$file" ]; then
              echo "‚úÖ $file exists"
              score=$((score + 1))
            else
              echo "üìÑ $file - creating template..."
              
              case "$file" in
                ".gitignore")
                  echo -e "# Dependencies\nnode_modules/\nbin/\nobj/\n\n# Environment\n.env\n\n# IDE\n.vscode/\n.idea/\n*.swp\n" > .gitignore
                  ;;
                "docker-compose.yml")
                  echo -e "version: '3.8'\n\nservices:\n  # To be implemented\n  placeholder:\n    image: hello-world" > docker-compose.yml
                  ;;
                ".env.example")
                  echo -e "# Environment Variables Template\nDB_CONNECTION=localhost\nAPI_PORT=5000\nAPP_NAME=Conference Room Booking" > .env.example
                  ;;
              esac
            fi
          done
          
          echo "---"
          echo "Documentation Score: $score/$total"
          
          if [ $score -ge 2 ]; then
            echo "‚úÖ Pass: Essential documentation present"
          else
            echo "‚ö†Ô∏è  Warning: Add more documentation"
          fi
